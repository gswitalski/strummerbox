<div class="song-edit">
    <header class="song-edit__header">
        <div class="song-edit__header-title">
            <button mat-icon-button type="button" class="song-edit__back" (click)="onCancel()" aria-label="Powrót do listy piosenek">
                <mat-icon>arrow_back</mat-icon>
            </button>
            <h1>Edytuj piosenkę</h1>
        </div>
        @if (!isLoading() && error() !== 'not_found' && error() !== 'load_failed') {
            <div class="song-edit__actions">
                <button mat-stroked-button type="button" (click)="onCancel()" [disabled]="isSaving()">
                    Anuluj
                </button>
                <button mat-flat-button color="primary" type="button" (click)="onSubmit()" [disabled]="!isFormValid() || isSaving()">
                    Zapisz
                </button>
            </div>
        }
    </header>

    @if (isSaving()) {
        <mat-progress-bar mode="indeterminate" class="song-edit__progress"></mat-progress-bar>
    }

    @if (isLoading()) {
        <div class="song-edit__loading">
            <mat-spinner></mat-spinner>
            <p>Ładowanie piosenki...</p>
        </div>
    } @else if (error() === 'not_found') {
        <div class="song-edit__error-page">
            <mat-icon class="song-edit__error-icon">error_outline</mat-icon>
            <h2>Nie znaleziono piosenki</h2>
            <p>Piosenka, którą próbujesz edytować, nie istnieje lub została usunięta.</p>
            <button mat-flat-button color="primary" (click)="onCancel()">
                Wróć do listy piosenek
            </button>
        </div>
    } @else if (error() === 'load_failed') {
        <div class="song-edit__error-page">
            <mat-icon class="song-edit__error-icon">error_outline</mat-icon>
            <h2>Wystąpił błąd</h2>
            <p>Nie udało się załadować piosenki. Spróbuj ponownie później.</p>
            <button mat-flat-button color="primary" (click)="onCancel()">
                Wróć do listy piosenek
            </button>
        </div>
    } @else {
        @if (error() === 'save_failed') {
            <div class="song-edit__error">
                Nie udało się zaktualizować piosenki. Spróbuj ponownie później.
            </div>
        }

        <stbo-song-edit-form
            class="song-edit__form"
            [initialData]="initialData()"
            [isSaving]="isSaving()"
            (saveSong)="onSaveSong($event)"
            (formValidityChange)="onFormValidityChange($event)"
        ></stbo-song-edit-form>
    }
</div>
