<h2 mat-dialog-title>Stwórz nowy repertuar</h2>

<mat-dialog-content>
    <form [formGroup]="form">
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nazwa repertuaru</mat-label>
            <input
                matInput
                formControlName="name"
                placeholder="Np. Wieczór z gitarą"
                maxlength="160"
                required
            />
            @if (nameControl.hasError('required') && nameControl.touched) {
                <mat-error>Nazwa jest wymagana</mat-error>
            }
            @if (nameControl.hasError('minlength') && nameControl.touched) {
                <mat-error>Nazwa musi mieć co najmniej 1 znak</mat-error>
            }
            @if (nameControl.hasError('maxlength') && nameControl.touched) {
                <mat-error>Nazwa może mieć maksymalnie 160 znaków</mat-error>
            }
            <mat-hint align="end">{{ nameControl.value.length || 0 }}/160</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Opis (opcjonalnie)</mat-label>
            <textarea
                matInput
                formControlName="description"
                placeholder="Dodaj opis repertuaru..."
                rows="3"
            ></textarea>
        </mat-form-field>

        @if (apiError()) {
            <div class="error-message">
                <mat-icon>error</mat-icon>
                <span>{{ apiError() }}</span>
            </div>
        }
    </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button
        mat-button
        type="button"
        (click)="onCancel()"
        [disabled]="isLoading()"
    >
        Anuluj
    </button>
    <button
        mat-raised-button
        color="primary"
        type="button"
        (click)="onSubmit()"
        [disabled]="form.invalid || isLoading()"
    >
        @if (isLoading()) {
            <mat-spinner diameter="20"></mat-spinner>
        } @else {
            Zapisz
        }
    </button>
</mat-dialog-actions>
