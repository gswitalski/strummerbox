@if (displayMode() === 'table') {
    <div class="repertoire-list__table-wrapper" [class.repertoire-list__table-wrapper--loading]="isLoading">
        <table
            mat-table
            [dataSource]="repertoires"
            matSort
            [matSortActive]="currentSort.active"
            [matSortDirection]="currentSort.direction"
            (matSortChange)="handleSortChange($event)"
            aria-label="Tabela repertuarów"
        >
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear="true"> Nazwa </th>
                <td mat-cell *matCellDef="let repertoire"> {{ repertoire.name }} </td>
            </ng-container>

            <ng-container matColumnDef="songCount">
                <th mat-header-cell *matHeaderCellDef> Liczba piosenek </th>
                <td mat-cell *matCellDef="let repertoire"> {{ repertoire.songCount }} </td>
            </ng-container>

            <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear="true"> Utworzono </th>
                <td mat-cell *matCellDef="let repertoire"> {{ repertoire.createdAt }} </td>
            </ng-container>

            <ng-container matColumnDef="updatedAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear="true"> Zaktualizowano </th>
                <td mat-cell *matCellDef="let repertoire"> {{ repertoire.updatedAt }} </td>
            </ng-container>

            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef> Status </th>
                <td mat-cell *matCellDef="let repertoire">
                    <div class="repertoire-list__status-toggle">
                        <mat-slide-toggle
                            [checked]="repertoire.isPublished"
                            [disabled]="repertoire.isTogglingStatus"
                            (change)="handleStatusChange(repertoire.id, repertoire.isPublished)"
                            [attr.aria-label]="repertoire.isPublished ? 'Cofnij publikację repertuaru ' + repertoire.name : 'Opublikuj repertuar ' + repertoire.name"
                        >
                            {{ repertoire.isPublished ? 'Opublikowany' : 'Szkic' }}
                        </mat-slide-toggle>
                        @if (repertoire.isTogglingStatus) {
                            <mat-progress-spinner
                                mode="indeterminate"
                                diameter="20"
                                aria-label="Trwa zmiana statusu"
                            ></mat-progress-spinner>
                        }
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Akcje </th>
                <td mat-cell *matCellDef="let repertoire">
                    <div class="repertoire-list__actions">
                        <button
                            mat-icon-button
                            type="button"
                            (click)="handleEditRepertoire(repertoire.id)"
                            [attr.aria-label]="'Edytuj repertuar ' + repertoire.name"
                        >
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button
                            mat-icon-button
                            type="button"
                            (click)="handleShareRepertoire(repertoire.id)"
                            [attr.aria-label]="'Udostępnij repertuar ' + repertoire.name"
                        >
                            <mat-icon>share</mat-icon>
                        </button>
                        <button
                            mat-icon-button
                            type="button"
                            color="warn"
                            (click)="handleDeleteRepertoire(repertoire.id)"
                            [attr.aria-label]="'Usuń repertuar ' + repertoire.name"
                        >
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columns"></tr>
            <tr mat-row *matRowDef="let row; columns: columns"></tr>
        </table>

        @if (isLoading) {
            <div class="repertoire-list__overlay" aria-hidden="true" aria-live="polite">
                <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
            </div>
        }
    </div>
} @else {
    <div class="repertoire-list__cards" role="list">
        @for (repertoire of repertoires; track trackByRepertoireId($index, repertoire)) {
            <mat-card class="repertoire-list__card" role="listitem">
                <mat-card-header>
                    <mat-card-title>{{ repertoire.name }}</mat-card-title>
                    <mat-card-subtitle>
                        Utworzono: {{ repertoire.createdAt }} • Zaktualizowano: {{ repertoire.updatedAt }}
                    </mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                    <p class="repertoire-list__song-count">
                        <mat-icon aria-hidden="true">music_note</mat-icon>
                        {{ repertoire.songCount }} {{ repertoire.songCount === 1 ? 'piosenka' : 'piosenek' }}
                    </p>
                    <div class="repertoire-list__status-toggle">
                        <mat-slide-toggle
                            [checked]="repertoire.isPublished"
                            [disabled]="repertoire.isTogglingStatus"
                            (change)="handleStatusChange(repertoire.id, repertoire.isPublished)"
                            [attr.aria-label]="repertoire.isPublished ? 'Cofnij publikację repertuaru ' + repertoire.name : 'Opublikuj repertuar ' + repertoire.name"
                        >
                            {{ repertoire.isPublished ? 'Opublikowany' : 'Szkic' }}
                        </mat-slide-toggle>
                        @if (repertoire.isTogglingStatus) {
                            <mat-progress-spinner
                                mode="indeterminate"
                                diameter="20"
                                aria-label="Trwa zmiana statusu"
                            ></mat-progress-spinner>
                        }
                    </div>
                </mat-card-content>
                <mat-card-actions>
                    <button
                        mat-button
                        type="button"
                        (click)="handleEditRepertoire(repertoire.id)"
                        [attr.aria-label]="'Edytuj repertuar ' + repertoire.name"
                    >
                        <mat-icon>edit</mat-icon>
                        Edytuj
                    </button>
                    <button
                        mat-button
                        type="button"
                        (click)="handleShareRepertoire(repertoire.id)"
                        [attr.aria-label]="'Udostępnij repertuar ' + repertoire.name"
                    >
                        <mat-icon>share</mat-icon>
                        Udostępnij
                    </button>
                    <button
                        mat-button
                        color="warn"
                        type="button"
                        (click)="handleDeleteRepertoire(repertoire.id)"
                        [attr.aria-label]="'Usuń repertuar ' + repertoire.name"
                    >
                        <mat-icon>delete</mat-icon>
                        Usuń
                    </button>
                </mat-card-actions>
            </mat-card>
        }

        @if (isLoading) {
            <div class="repertoire-list__overlay" aria-hidden="true" aria-live="polite">
                <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
            </div>
        }
    </div>
}

