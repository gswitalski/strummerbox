<!-- Stan błędu -->
@if (isError && error) {
    <div class="error-container">
        <stbo-error-display
            [code]="error.code"
            [message]="error.message">
        </stbo-error-display>
    </div>
}

<!-- Stan ładowania -->
@if (isLoading) {
    <div class="loading-container">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
}

<!-- Stan załadowany -->
@if (isLoaded && title && content) {
    <div class="song-viewer">
        <!-- Toolbar -->
        <mat-toolbar class="song-toolbar" color="primary">
            <!-- Przycisk powrotu -->
            @if (config.showBackButton && config.backLink) {
                <button
                    mat-icon-button
                    [routerLink]="config.backLink"
                    class="back-button"
                    [attr.aria-label]="config.backButtonAriaLabel || 'Powrót'">
                    <mat-icon>arrow_back</mat-icon>
                </button>
            }

            <!-- Tytuł w toolbarze (jeśli konfiguracja na to pozwala) -->
            @if (config.titleInToolbar) {
                <h1 class="song-title">{{ title }}</h1>
            }

            <!-- Przełącznik akordów -->
            @if (config.showChordsToggle) {
                <mat-button-toggle-group
                    [value]="showChords ? 'chords' : 'text'"
                    (change)="onChordsToggleChange($event.value)"
                    class="chord-toggle"
                    aria-label="Przełącznik widoku">
                    <mat-button-toggle value="text">Tekst</mat-button-toggle>
                    <mat-button-toggle value="chords">Akordy</mat-button-toggle>
                </mat-button-toggle-group>
            }

            <!-- Kontrolki transpozycji - widoczne gdy akordy są włączone -->
            @if (config.showTransposeControls && showChords) {
                <stbo-transpose-controls
                    [offset]="transposeOffset"
                    (offsetChange)="onTransposeChange($event)">
                </stbo-transpose-controls>
            }
        </mat-toolbar>

        <!-- Treść piosenki -->
        <div class="song-content-wrapper">
            <!-- Tytuł poza toolbarem (jeśli konfiguracja na to pozwala) -->
            @if (!config.titleInToolbar) {
                <h1 class="song-title">{{ title }}</h1>
            }

            <div class="song-lyrics-container">
                <stbo-song-display
                    [content]="content"
                    [showChords]="showChords"
                    [transposeOffset]="transposeOffset"
                    class="song-content">
                </stbo-song-display>
            </div>
        </div>

        <!-- Nawigacja między piosenkami -->
        @if (config.showNavigation && navigation) {
            <stbo-song-navigation [navigation]="navigation"></stbo-song-navigation>
        }

        <!-- Pływający przycisk akcji (FAB) do udostępniania -->
        @if (config.showQrButton) {
            <button
                mat-fab
                extended
                color="primary"
                class="qr-fab"
                (click)="onQrButtonClick()"
                aria-label="Pokaż kod QR">
                <mat-icon>qr_code</mat-icon>
                Udostępnij
            </button>
        }
    </div>
}
